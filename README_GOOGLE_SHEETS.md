# 구글 시트 연동 설정 가이드

## 1. 구글 시트 웹스크립트 설정

### 단계 1: 구글 시트 생성
1. [Google Sheets](https://sheets.google.com)에 접속
2. 새 스프레드시트 생성
3. 시트 이름을 "주문내역"으로 변경 (또는 원하는 이름으로)

### 단계 2: Apps Script 설정
1. 구글 시트에서 **확장 프로그램** > **Apps Script** 클릭
2. `google-sheets-script.js` 파일의 내용을 복사하여 붙여넣기
3. 저장 (Ctrl+S 또는 Cmd+S)

### 단계 3: 웹 앱 배포
1. Apps Script 편집기에서 **배포** > **새 배포** 클릭
2. **유형 선택** 옆의 설정 아이콘(⚙️) 클릭
3. **웹 앱** 선택
4. 설정:
   - **설명**: "운명테라피 주문 데이터 수집"
   - **실행 사용자**: 나
   - **액세스 권한**: 모든 사용자
5. **배포** 클릭
6. **승인 필요** 팝업이 나타나면:
   - **권한 확인** 클릭
   - Google 계정 선택
   - **고급** > **운명테라피(안전하지 않을 수 있음)로 이동** 클릭
   - **허용** 클릭
7. 배포 완료 후 **웹 앱 URL** 복사

### 단계 4: 환경 변수 설정
1. 프로젝트 루트에 `.env.local` 파일 생성 (없는 경우)
2. 다음 내용 추가:

```env
GOOGLE_SHEETS_WEB_APP_URL=https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec
```

⚠️ **중요**: `YOUR_WEB_APP_ID`를 실제 웹 앱 URL로 교체하세요.

### 단계 5: 테스트
1. Apps Script 편집기에서 `testDoPost` 함수 선택
2. **실행** 버튼 클릭
3. 권한 승인 후 실행
4. 구글 시트에 테스트 데이터가 추가되었는지 확인

## 2. 시트 구조

구글 시트에 다음 컬럼이 자동으로 생성됩니다:

| 컬럼 | 설명 |
|------|------|
| 제출일시 | 주문 접수 시간 |
| 이름 | 고객 이름 |
| 생년월일 | 생년월일 |
| 생시 | 출생 시간 |
| 음력/양력 | 음력/양력 구분 |
| 성별 | 남성/여성 |
| 이메일 | 이메일 주소 |
| 궁금한 점 | 고객 질문 |
| 인원수 | 분석 인원 수 |
| 결제금액 | 총 결제 금액 |
| 결제상태 | 결제 상태 (결제완료) |
| 주문번호 | 고유 주문번호 |

## 3. 작동 방식

1. 사용자가 폼을 작성하고 "결제하고 인생 지도 받기" 버튼 클릭
2. 가상 결제 완료 처리 (실제 토스 링크페이 연동 전까지)
3. `/api/submit` API로 데이터 전송
4. API가 구글 시트 웹 앱 URL로 데이터 전송
5. 구글 시트에 자동으로 데이터 추가

## 4. 주의사항

- 웹 앱 URL은 절대 공개하지 마세요
- `.env.local` 파일은 `.gitignore`에 포함되어 있어야 합니다
- 실제 토스 링크페이 연동 시, 결제 완료 후에만 구글 시트로 데이터를 전송하도록 수정해야 합니다

## 5. 트러블슈팅

### 데이터가 시트에 저장되지 않는 경우
1. 웹 앱 URL이 올바른지 확인
2. Apps Script의 실행 권한이 올바르게 설정되었는지 확인
3. 브라우저 콘솔에서 에러 메시지 확인
4. Apps Script의 실행 로그 확인 (보기 > 실행 기록)

### CORS 오류가 발생하는 경우
- Apps Script의 웹 앱 설정에서 "액세스 권한"을 "모든 사용자"로 설정했는지 확인
